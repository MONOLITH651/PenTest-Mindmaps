# Securing Protocols and Applications
## DNS Security

##### **DNS (Domain Name System)**
- **Ports:** TCP and UDP port 53.
- **Issues:** 
  - **Domain Hijacking:** Potential for unauthorized individuals to take over a domain.
  - **URL Redirection:** Attackers can redirect traffic to malicious sites.
  - **Cache Poisoning:** Injection of fake domain information into DNS server caches.
- **Secure Version:** DNSSec, which utilizes certificates for DNS zones to enhance security.

##### **SNMP (Simple Network Management Protocol)**
- **Ports:** UDP ports 161 and 162.
- **Versions:** 
  - **Version 1:** Unencrypted, vulnerable to interception.
  - **Version 2:** Introduced some security improvements.
  - **Version 3:** Fully encrypted and secure, recommended for use.

##### **SSH (Secure Shell)**
- **Port:** TCP port 22.
- **Purpose:** Secure replacement for Telnet, which lacked encryption.

##### **FTP (File Transfer Protocol)**
- **Ports:** 
  - **Standard FTP:** TCP ports 20 and 21.
  - **FTPS (FTP Secure/FTP over SSL):** Runs on TCP port 990, using SSL for encryption.
  - **SFTP (SSH File Transfer Protocol):** Runs on TCP port 22, using SSH for encryption.

##### **SRTP (Secure Real-Time Transport Protocol)**
- **Port:** UDP port 5004.
- **Purpose:** Provides encryption for voice over IP (VoIP) communications to prevent eavesdropping.


## FTP Packet Capture

##### **FTP Overview**
- **Purpose:** Used to transmit files over a TCP/IP network across various operating systems like Linux, Windows, macOS, and smartphones.
- **Vulnerability:** 
  - **Plain FTP:** Transmits authentication credentials (username and password) in plain text, making it susceptible to interception.
  - **Secure Alternatives:** SFTP (SSH File Transfer Protocol) and FTPS (FTP Secure/FTP over SSL) are recommended to prevent vulnerabilities associated with plain FTP.

##### **Wireshark Analysis of FTP Traffic**
- **Protocol Filtering:** FTP traffic can be filtered in Wireshark using the filter bar by typing "FTP".
- **Headers Analysis:**
  - **IP Header and TCP Header:** FTP uses TCP as its transport protocol, typically utilizing ports 20 and 21.
  - **Port Usage:** 
    - **Port 21:** Generally used for FTP commands and control.
    - **Port 20:** Used for data transfer in active mode FTP.

##### **FTP Traffic Vulnerability Demonstration**
- **Readability in Wireshark:**
  - **Username Exposure:** Usernames, such as "administrator," can be easily viewed.
  - **Password Exposure:** Passwords are transmitted in plain text, making them easily accessible if traffic is captured.

##### **Mitigation Strategies**
- **Network Access Limitation:** Restrict access to minimize exposure to plain text FTP traffic.
- **Use of Secure Protocols:** Opt for SFTP or FTPS to encrypt data and protect against interception.
- **IPsec Implementation:** Employ IPsec on internal LANs to ensure encrypted communication between endpoints.
## Secure Web and E-mail

##### **Securing Web Applications**
- **Internal vs External:** Web applications can be internal (intranet) or external (internet). Regardless of their location, securing them should follow the same rigorous standards.
- **Hiding Web Server Identity:**
  - **Load Balancing:** Connects users to the load balancer's IP, concealing the backend servers' IPs.
  - **Reverse Proxying:** Translates public IP addresses and ports to internal private IPs and ports, providing additional security by making the server less visible.
  - **Network Address Translation (NAT):** Operates up to layer four of the OSI model, whereas reverse proxying can go up to layer seven, allowing for more sophisticated security measures like user authentication and access control.

##### **HTTPS and TLS Configuration**
- **Importance of HTTPS:** HTTPS is essential for securing communications to and from web applications.
- **Enabling HTTPS:** 
  - **Certificate Requirement:** A PKI certificate is necessary to enable HTTPS on a web server.
  - **Port Usage:** HTTP typically uses TCP port 80, while HTTPS uses TCP port 443.
  - **TLS (Transport Layer Security):** TLS 1.2 or higher should be used. Earlier versions and SSL are deprecated due to known vulnerabilities.

##### **Enabling HTTPS on IIS (Internet Information Services)**
- **Step-by-Step Configuration:**
  - **Access IIS Manager:** Navigate to the Internet Information Services Manager through the start menu.
  - **Edit Bindings:** Right-click on the website and choose "Edit Bindings" to add an HTTPS binding.
  - **Select Certificate:** Choose the appropriate PKI certificate for the server. This may be a public certificate from a trusted authority or a self-signed certificate.
  - **Finalize Configuration:** After adding the HTTPS binding, adjust firewall rules if necessary to allow traffic on port 443.

##### **Securing LDAP (Lightweight Directory Access Protocol)**
- **LDAP Overview:** LDAP is used for directory services, such as Microsoft Active Directory, to manage and replicate network configuration data.
- **LDAPs (Secure LDAP):**
  - **Port Usage:** LDAP typically uses TCP port 389. When secured with a PKI certificate, LDAPs uses TCP port 636.
  - **PKI Certificate Requirement:** A certificate, either public or self-signed, is necessary to enable LDAPs.

##### **Securing Email Protocols**
- **SMTP (Simple Mail Transfer Protocol):**
  - **Domain Reputation:** Security appliances can use domain reputation to filter incoming mail based on known spamming domains.
  - **S/MIME:** S/MIME (Secure/Multipurpose Internet Mail Extensions) is used to encrypt and digitally sign email messages, ensuring confidentiality and authenticity.
  - **Client Configuration:** Requires a PKI certificate to enable S/MIME on the email client.

- **POP and IMAP:**
  - **POP (Post Office Protocol):** Used by clients to retrieve mail from a server.
  - **IMAP (Internet Message Access Protocol):** Offers more advanced features than POP, such as selective folder synchronization.
  - **Security Binding:** Both protocols can be secured with a PKI certificate to ensure secure communication between email clients and servers.
## Request Forgery Attacks

##### **Cross-Site Request Forgery (CSRF)**
- **Overview:** CSRF is an attack that targets users' session tokens in web applications, enabling attackers to send unauthorized requests on behalf of authenticated users.
- **Attack Method:**
  - **User Session:** When a user signs into a secure website (e.g., online banking) using HTTPS, the browser stores a session cookie that authenticates the user's session.
  - **Attacker Exploitation:** An attacker tricks the user into clicking a malicious link or visiting a fake website, gaining access to the session cookies.
  - **Implications:** The attacker can send unauthorized requests, such as transferring funds, without the user's knowledge, as it appears to be a legitimate session to the web application.
- **Mitigation Strategies:**
  - **Hardening Client Devices:** Ensure all user devices, including smartphones and tablets, are secured against such attacks.
  - **Web Application Firewall (WAF):** Deploy a WAF to detect and block CSRF attempts by analyzing and filtering malicious traffic.

##### **Server-Side Request Forgery (SSRF)**
- **Overview:** SSRF is similar to CSRF but targets web servers instead of client sessions. The attacker manipulates a vulnerable server to make unauthorized requests to other servers.
- **Attack Method:**
  - **Compromised Web Server:** An attacker exploits a vulnerable front-end web server that communicates with a back-end database.
  - **Malicious Requests:** The compromised web server is manipulated to send unauthorized requests to the back-end database, potentially exposing sensitive customer information.
- **Example Scenario:**
  - **Front-End Web Server:** A public-facing web server that interacts with a back-end database containing customer records.
  - **Attacker Exploitation:** The attacker formulates a request that the compromised web server executes, gaining unauthorized access to the back-end database and retrieving customer records.

##### **Defense Measures Against CSRF and SSRF**
- **Client-Side Defense:**
  - **Hardening User Devices:** Protect devices from being compromised by malicious links or files.
- **Server-Side Defense:**
  - **Web Application Firewall:** A WAF specifically looks for CSRF and SSRF patterns, mitigating these attacks by filtering and blocking malicious traffic.

## Cross-Site Scripting Attacks
##### **Cross-Site Scripting (XSS) Overview**
- **Definition:** XSS is an attack that occurs when a web application does not properly validate or sanitize user-supplied input, allowing attackers to inject malicious scripts into web pages viewed by other users.
- **Attack Method:**
  - **User Input:** Attackers exploit web forms or URL fields by injecting malicious JavaScript code.
  - **Execution:** The injected JavaScript runs on the client’s web browser when they interact with the affected web page, executing in their session without their knowledge.

##### **Impact of XSS Attacks**
- **Client-Side Execution:** The malicious JavaScript runs on the client’s web browser, not on the server, potentially leading to a variety of harmful actions, such as reading files or stealing session cookies.
- **Examples:**
  - **Stored XSS Attack:** The malicious code is stored on the server (e.g., in a comment or post) and executes when other users view the page.

##### **Demonstration Using Metasploitable 2**
- **Metasploitable 2:** A virtual machine designed for security testing, containing intentionally vulnerable web applications like DVWA (Damn Vulnerable Web Application).
- **Testing XSS:**
  - **DVWA Setup:** Ensure the web app is set to low security to test vulnerabilities like XSS.
  - **Injecting Malicious Code:** Enter a JavaScript alert function (e.g., `alert('You have been hacked!')`) into a form field designed to collect user input.
  - **Execution:** The code executes immediately after submission, demonstrating how easily an XSS attack can occur.

##### **Prevention and Mitigation**
- **Input Validation:** Developers must validate and sanitize all user inputs to prevent the injection of malicious code.
- **Vulnerability Scanning:** Regularly scan web applications for potential vulnerabilities, including XSS, to ensure they are not exploitable.

## Web Application Security

##### **Shared Responsibility**
- **Web Developers and Administrators:** Securing a web application is the joint responsibility of both web developers and the administrators who manage the servers hosting the application.
- **Applicability:** The same security hardening techniques apply whether the application is public-facing or internal (intranet).

##### **Common Attack Vectors**
- **SQL, LDAP, and XML Injection:** These attacks exploit improper handling of user input. 
- **Mitigation:** 
  - **Input Sanitization:** Developers must sanitize user input to prevent malicious data from being processed.
  - **Secure Coding Practices:** Employ secure coding practices to ensure that only valid, expected data is accepted.

##### **Security Best Practices**
- **Input Validation:** Ensure that all user input is validated and sanitized.
- **HTTPS Connectivity:** Require strict HTTPS connections to prevent data interception.
- **HTTP Header Management:** Configure HTTP headers to restrict methods like PUT or POST if the application is intended to be read-only.
- **Code Signing:** Developers should digitally sign their code, ensuring that it is verified when executed, thus protecting against unauthorized code modifications.
- **Trusted Components and APIs:** Use only trusted components and APIs to minimize security risks.

##### **Software Development Life Cycle (SDLC)**
- **Security Integration:** Security must be integrated into every phase of the SDLC, from planning and design to coding, testing, and deployment.
- **Avoiding Post-Development Fixes:** Addressing security after development can lead to serious issues, increased costs, and potential fines or loss of customer trust.

##### **Continuous Integration and Continuous Delivery (CI/CD)**
- **Automation in CI/CD:** Automate processes like code check-ins, quality assurance testing, and update notifications to streamline development.
- **Security Concerns:** 
  - **Potential Attacks:** If attackers compromise the automation process, they could inject malicious code that is then compiled, tested, and distributed to customers.
  - **Importance of Security in CI/CD:** Secure the automation pipeline to prevent unauthorized changes.

##### **Infrastructure as Code**
- **Definition:** Infrastructure as Code involves automating the provisioning of virtual machines and cloud resources using predefined templates.
- **Security Risks:**
  - **Template Modification:** If an attacker alters a template, they could introduce backdoors or unauthorized accounts, leading to potential security breaches.
  - **Consistency in Deployment:** Ensure that templates are secure and unmodified to prevent unauthorized access.

##### **Software Testing**
- **Static Testing (Code Review):** Involves reviewing code for potential security issues, logic errors, and vulnerabilities that may not be evident through automated testing.
- **Dynamic Testing (Runtime Testing):**
  - **Fuzzing:** This technique involves bombarding the application with random, unexpected data to observe its behavior, such as crashes or unintended disclosures of sensitive information.
  - **Purpose of Fuzzing:** Identify and fix weaknesses to harden the application against potential attacks.

## OWASP Top 10
##### **Introduction to OWASP Top Ten**
- **OWASP Overview:** The Open Web Application Security Project (OWASP) is a non-profit organization that highlights the most critical web application security risks. The OWASP Top Ten list is a widely recognized resource for understanding these risks.
- **Update Frequency:** The OWASP Top Ten is updated approximately every 3 to 4 years to reflect the evolving threat landscape.

##### **2021 OWASP Top Ten Vulnerabilities**
- **Broken Access Control**
  - **Overview:** Similar to a bouncer allowing unauthorized individuals into a club, broken access control occurs when an application fails to enforce proper restrictions on what authenticated users are allowed to do.
  - **Mitigation:** Automate vulnerability testing during development to ensure that access rights are correctly assigned and enforced.

- **Cryptographic Failures**
  - **Overview:** Previously known as sensitive data exposure, cryptographic failures occur when sensitive data is not properly protected. This is akin to leaving your laptop open with confidential information visible.
  - **Mitigation:** Ensure proper encryption practices are followed to protect sensitive data from exposure.

- **Injection Attacks**
  - **Overview:** Injection flaws occur when untrusted data is sent to an interpreter as part of a command or query. This is like using the wrong key to unlock a door, yet the door still opens.
  - **Types:** Includes SQL injection, LDAP injection, and XML injection, among others. Cross-site scripting (XSS) has also been folded into this category.
  - **Mitigation:** Validate and sanitize all user inputs to prevent malicious data from being executed.

- **Insecure Design**
  - **Overview:** This new category addresses flaws in the design phase of a web application. Insecure design occurs when security is not considered during the initial planning and architecture stages.
  - **Mitigation:** Integrate security considerations into the design phase of the Software Development Life Cycle (SDLC).

- **Security Misconfiguration**
  - **Overview:** Previously related to XML external entities, security misconfigurations occur when systems or applications are not properly configured, leaving them vulnerable to attacks. An example is leaving default settings enabled.
  - **Mitigation:** Regularly review and update configurations, ensuring that security settings are properly applied and maintained.

- **Vulnerable and Outdated Components**
  - **Overview:** Using outdated or vulnerable software components is like building a house with weak bricks. Attackers can exploit these components to compromise the application.
  - **Mitigation:** Keep software components updated, and replace outdated components with newer, supported versions.

- **Identification and Authentication Failures**
  - **Overview:** Previously known as broken authentication, this vulnerability occurs when an application fails to properly verify the identity of a user, allowing attackers to masquerade as legitimate users.
  - **Mitigation:** Implement strong authentication mechanisms and regularly test authentication processes to prevent unauthorized access.

- **Software and Data Integrity Failures**
  - **Overview:** This category includes insecure deserialization, where vulnerabilities arise from improperly handling serialized data. It’s like making incorrect assumptions about the safety of software updates or CI/CD processes.
  - **Mitigation:** Ensure thorough testing and validation of software updates and CI/CD processes to prevent the introduction of vulnerabilities.

- **Security Logging and Monitoring Failures**
  - **Overview:** If an application fails to log and monitor suspicious activities effectively, it’s like ignoring alarm bells. Prompt detection and response are crucial for minimizing damage from attacks.
  - **Mitigation:** Implement robust logging and monitoring systems to quickly identify and respond to security incidents.

- **Server-Side Request Forgery (SSRF)**
  - **Overview:** SSRF occurs when a server fails to validate incoming URLs or code from the client, allowing attackers to use the server as a proxy for malicious actions, such as accessing internal services or executing remote code.
  - **Mitigation:** Validate and sanitize all incoming requests to prevent the server from being used as a proxy for malicious activities.

## Web App Vulnerability Scanning

##### **Introduction to Web Application Vulnerabilities**
- **Importance of Vulnerability Awareness:** To effectively harden a web application, it’s crucial to understand its vulnerabilities. This can be achieved using specialized vulnerability assessment tools designed for web applications.

##### **OWASP ZAP Overview**
- **Tool Introduction:** OWASP ZAP (Zed Attack Proxy) is a tool specifically designed for testing web applications for vulnerabilities. It acts as a proxy, sitting between the user and the web application to monitor and analyze requests and responses.
- **Installation:** 
  - **Windows Installation:** Requires Java Runtime Environment (JRE). Available for download from the ZAP official website.
  - **Kali Linux:** Pre-installed in the Kali Linux distribution.

##### **Running an Automated Scan with OWASP ZAP**
- **Initial Setup:** Once ZAP is installed, the first step is to run an automated scan. This is done by specifying the URL of the target web application and initiating the scan.
- **Scanning Process:**
  - **Spidering:** ZAP examines every aspect of the web application, including pages, hyperlinks, HTML content, JavaScript, and web development components.
  - **Version Detection:** ZAP checks for outdated components that could introduce security vulnerabilities.

##### **Interpreting Scan Results**
- **Alerts Section:** 
  - **Application Error Disclosures:** Identifies instances where the web application might be disclosing too much information, such as error messages that reveal sensitive details.
  - **Directory Traversal Attack:** Detects vulnerabilities that allow unauthorized browsing of the file system through the web application.
  - **Vulnerable JavaScript Libraries:** Alerts on outdated JavaScript libraries with known vulnerabilities, requiring updates to mitigate risks.
  - **Private IP Address Disclosure:** Highlights the exposure of private IP addresses, which should be concealed, especially for public-facing applications.

##### **Real-World Implications**
- **Case Study - Equifax Breach:** The 2017 Equifax breach serves as a cautionary tale where failure to update an outdated component (Apache Struts) led to a massive data breach. ZAP could have identified such vulnerabilities, allowing them to be patched before exploitation.
- **Collaboration with Developers:** Security assessors may not be web developers, and when vulnerabilities are found, collaboration with the development team is essential. Screenshots and detailed descriptions of the issues found by ZAP should be shared with developers for remediation.

##### **Best Practices for Using ZAP**
- **Allow the Scan to Complete:** Ensure the scan is fully completed before drawing conclusions about the security posture of the web application.
- **Continuous Monitoring:** Regularly scan the web application using ZAP to keep up with new vulnerabilities and ensure ongoing security.
