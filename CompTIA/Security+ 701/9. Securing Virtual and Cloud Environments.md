# Securing Virtual and Cloud Environments
## Common Attacks and Mitigations  

##### **Distributed Denial of Service (DDoS) Attacks**
- **Definition:** An attack where multiple compromised systems (botnets) flood a target with useless traffic, preventing legitimate traffic from accessing the network or service.
- **Key Concepts:**
  - **Bot/Zombie:** An infected computer under malicious user control.
  - **Botnet:** A network of compromised computers controlled by a malicious actor to perform coordinated attacks.
- **Mitigation Techniques:**
  - **Throttling:** Monitoring traffic rates and slowing down or discarding traffic that exceeds normal thresholds.
  - **Black Hole Routing:** Redirecting suspected malicious traffic to a non-existent destination (a "black hole") to mitigate the attack.

##### **URL Hijacking**
- **Definition:** An attack that takes advantage of user errors (e.g., misspelling a URL) to redirect them to a malicious site.
- **Key Concepts:**
  - **Typosquatting:** Registering misspelled versions of popular domain names to capture traffic meant for legitimate sites.
  - **Tainted Search Results:** Manipulating DNS queries to direct users to malicious sites.
- **Mitigation:** Hardening DNS servers to prevent tampering and ensuring users are aware of potential risks.

##### **Session Replay Attacks**
- **Definition:** An attack where an attacker captures and reuses session information (e.g., cookies) to impersonate a user in an authenticated session.
- **Key Concepts:**
  - **Browser Hijacking:** Compromising a user's browser to capture session data.
  - **Cookie Security:** Ensuring sensitive session data is not easily accessible or manipulated.
- **Mitigation:**
  - **HttpOnly Flag:** Preventing JavaScript access to cookies in the browser to reduce the risk of session hijacking.

##### **Pass the Hash Attack**
- **Definition:** An attack where an attacker uses a stolen password hash to authenticate as the victim without needing to crack the actual password.
- **Key Concepts:**
  - **Hash in Memory:** Older systems might store password hashes in memory, making them vulnerable to extraction.
  - **Authenticated Session:** The attacker leverages an existing authenticated session to steal and use the hash.
- **Mitigation:**
  - **Use Updated Systems:** Ensure systems are running modern operating systems that do not store password hashes in memory.
  - **Regular Patching:** Keep systems patched to protect against known vulnerabilities.

##### **Managed Security Service Provider (MSSP)**
- **Definition:** A third-party service provider offering outsourced cybersecurity services, including monitoring, vulnerability scanning, and attack mitigation.
- **Key Services:**
  - **24/7 Security Monitoring:** Continuous monitoring of network activity for signs of suspicious behavior.
  - **Vulnerability Scans/Penetration Testing:** Regular assessments to identify and address security weaknesses.
  - **Security Reporting:** Providing detailed reports on the state of network security and potential vulnerabilities.
## DDoS Attacks in the Real World  
##### **Reflected DDoS Attacks**
- **Definition:** An attack where the attacker sends requests to vulnerable third-party servers, making it appear as though the requests come from the victim. The third-party servers then send responses back to the victim, overwhelming them with traffic.
- **Key Mechanism:**
  - **Spoofing:** The attacker spoofs the victim's IP address to make it appear as though the request originated from the victim.

##### **Amplified DDoS Attacks**
- **Definition:** An attack where the attacker exploits the difference in size between a request and a response. The attacker sends a small request to a server, which then responds with a much larger response, overwhelming the victim with amplified traffic.
- **Key Mechanism:**
  - **Request-Response Discrepancy:** The attacker sends a small request that generates a significantly larger response from the server, amplifying the attack's impact.

##### **Real-World Example: Network Time Protocol (NTP) Amplification Attack**
- **Scenario:** The attacker sends a small "get monlist" request to an NTP server, which asks for a list of the last 600 IP addresses that connected to the server.
- **Attack Process:**
  - **Request:** The attacker sends a small request to the NTP server, spoofing the victim's IP address.
  - **Amplification:** The NTP server sends a large response list to the victim, overwhelming their bandwidth.
  
##### **Combination of Reflected and Amplified DDoS Attacks**
- **Interchangeability:** Reflected and amplified attacks are often used interchangeably or in combination because many reflected attacks inherently involve amplification.
- **Key Potency:** The effectiveness of these attacks lies in the attacker's ability to generate massive traffic toward the victim using relatively small efforts by exploiting natural behaviors of internet protocols.
## Containers and Software-Defined Networking  
##### **Overview of Application Containers**
- **Definition:** A logical boundary that houses application components, allowing them to run independently in small, modular, task-specific units called microservices.
- **Purpose:** Decouple application components from relying on a single, large monolithic app, enabling faster and more flexible application deployment and management.
- **Contents:** Application files and necessary resources like web servers, without including an entire operating system.

##### **How Application Containers Work**
- **Host Operating System:** The underlying OS (e.g., Windows, Linux) where the containers run.
- **Container Engine:** Software like Docker, which manages and runs application containers.
- **Container Characteristics:** Containers are lightweight, starting quickly because they leverage the already running host OS, unlike virtual machines which require the entire OS to start.

##### **Managing Containers in Linux**
- **Installing Docker:**
  - **Command Example:** `sudo apt install docker.io`
  - **Starting Docker Service:** 
    - **Command Example:** `sudo service docker start`
    - **Verification:** `sudo service docker status`
- **Pulling and Running Containers:**
  - **Pulling a Container Image:** 
    - **Command Example:** `sudo docker pull alpine`
  - **Running a Container in Interactive Mode:** 
    - **Command Example:** `sudo docker run -it alpine`
    - **Exploring the Container's File System:** Use `LS` and other Linux commands within the container.

##### **Example Containers**
- **Alpine Container:** A small container image that allows configuration of Linux settings.
- **Caddy Container:**
  - **Purpose:** Runs a simple web server within a container.
  - **Running the Container in Detached Mode:** 
    - **Command Example:** `sudo docker run -d -p 80:80 caddy`
  - **Verifying the Running Container:** 
    - **Command Example:** `sudo docker ps`
  - **Accessing the Web Server:** Use the host's IP address (e.g., `192.168.4.108`) in a web browser to view the containerized web page.

##### **Security Considerations for Application Containers**
- **Understanding the Environment:** Essential for effective security hardening. Without knowledge of containers, it may be difficult to identify running services or potential vulnerabilities.
- **Vulnerability Scanning:** Containers may expose ports (e.g., port 80) even when the host system doesn’t have the corresponding service installed, which can be confusing if containerization isn’t considered.
- **Cloud Deployment:** Containers can also be deployed in cloud environments, integrating with Software Defined Networking (SDN) and simplifying network configuration through user-friendly interfaces.
## Hypervisors and Virtual Machines  
##### **Hypervisors Overview**
- **Definition:** The operating system that manages virtual machine (VM) guests. It runs on a regular server and supports the VMs.
- **Examples:** Microsoft Hyper-V, VMware ESXi, VMware Workstation, VirtualBox.
- **On-Premises vs. Cloud:**
  - **On-Premises:** Offers full configuration control but requires responsibility for acquisition, support, and maintenance.
  - **Cloud:** VMs run on someone else's hypervisor, with no need to manage the underlying infrastructure.
  - **Hybrid:** For high availability, VMs can be replicated from on-premises to the cloud.

##### **Types of Hypervisors**
- **Type 1 (Bare Metal):** 
  - **Definition:** The hypervisor is the operating system itself, designed solely to manage virtual machines.
  - **Example:** VMware ESXi.
  - **Use Case:** Preferred in enterprise environments for mission-critical workloads due to its stability.
- **Type 2:**
  - **Definition:** Runs as an application on top of an existing operating system.
  - **Example:** VMware Workstation on Windows.
  - **Use Case:** Suitable for environments where the primary OS serves multiple functions beyond VM management.

##### **Security Considerations for Virtual Machines**
- **Similar Vulnerabilities:** VMs share the same vulnerabilities as physical servers, requiring regular OS and application patching, user account management, and service hardening.
- **Hypervisor Hardening:** The underlying hypervisor also needs to be secured in the same way as other servers on the network.
- **VM Sprawl:**
  - **Definition:** The uncontrolled proliferation of virtual machines, especially in cloud environments where deployment is quick and easy.
  - **Risk:** Increases the attack surface, leading to potential exposure to vulnerabilities if VMs are forgotten or left running with public IP addresses.
- **VM Escape:**
  - **Definition:** A rare but possible attack where a malicious user breaks out of a virtual machine to execute commands on the host operating system.
  - **Example:** CVE from 2008 involving VMware, allowing attackers to write files on the underlying host OS from within the VM.
  - **Mitigation:** Regularly update and patch hypervisors and be aware of known vulnerabilities.

##### **VM Hardening Techniques**
- **Standard Security Measures:** Disable unnecessary components, enforce complex passwords, use multi-factor authentication (MFA), and limit public internet visibility.
- **VM Encryption:**
  - **Purpose:** Encrypting a VM prevents unauthorized access by hypervisor administrators and requires a decryption passphrase to manage or start the VM.
  - **Implementation in VMware Workstation:**
    - **Steps:** 
      - Edit VM settings.
      - Navigate to Options > Access Control.
      - Select "Encrypt," enter and confirm the passphrase.
    - **Warning:** If the decryption passphrase is forgotten, access to the VM may be permanently lost.

## Cloud Deployment Models  
##### **Cloud Deployment Models**
- **Public Cloud:**
  - **Definition:** Available over the internet to any potential customer.
  - **Examples:** Alibaba Cloud, Amazon Web Services (AWS), Microsoft Azure.
  - **Characteristics:** Cloud tenant isolation, metered usage (Opex), shared responsibility between the cloud provider and the customer.
- **Private Cloud:**
  - **Definition:** Used exclusively by a single organization, offering full control over the infrastructure.
  - **Characteristics:** Requires upfront capital investment (CapEx), complete configuration flexibility, full responsibility for the cloud infrastructure.
- **Hybrid Cloud:**
  - **Definition:** Combines elements of both public and private clouds.
  - **Use Case:** Redundancy, where mission-critical VMs in a private cloud are replicated into a public cloud for safety.
- **Community Cloud:**
  - **Definition:** Designed to meet the specific requirements of a community of customers with similar needs.
  - **Examples:** Government Cloud (Microsoft Azure) for US government agencies, German Cloud for German agencies and organizations, industry-specific clouds like those for medical or financial sectors.

##### **Cloud Computing Characteristics**
- **Pooled Resources:** Underlying physical servers, storage arrays, and other resources that can be provisioned by users.
- **Broad Access:** Accessible over a network from any device.
- **Self-Service Provisioning:** Users can easily deploy services without needing help desk support.
- **Rapid Elasticity:** Ability to quickly provision or de-provision resources as needed.
- **Metered Usage:** Pay-as-you-go model, where usage is tracked and billed like a utility service.

##### **Additional Concepts**
- **Fog/Edge Computing:**
  - **Definition:** On-premises devices that cache cloud-stored content locally to provide faster access for users within the organization.
  - **Benefit:** Quicker access to files compared to retrieving them from the cloud over the internet.
- **Shared Responsibility:** 
  - **Definition:** In the cloud, the cloud provider is responsible for the underlying infrastructure, while the customer is responsible for managing their own resources, such as VMs and software patches.
  
##### **Security Considerations for Cloud Computing**
- **Virtual Private Network (VPN):** A site-to-site VPN can be set up from the on-premises network to the cloud, allowing private IP addresses to be used to access cloud resources.
- **Secure Access:** Cloud access typically secured via HTTPS or VPNs.

## Cloud Service Models  
##### **Common Cloud Service Models**

- **Infrastructure as a Service (IaaS):**
  - **Definition:** Provides virtualized computing resources over the internet. Includes infrastructure components like servers, storage, and networking.
  - **User Responsibility:** Configuration and management of virtual machines (VMs), applying patches, managing storage, and configuring virtual networks.
  - **Provider Responsibility:** Maintaining the underlying physical infrastructure that supports the VMs and storage.
  - **Example:** Deploying a storage account in Microsoft Azure.

- **Platform as a Service (PaaS):**
  - **Definition:** Offers a platform allowing customers to develop, run, and manage applications without dealing with the underlying infrastructure.
  - **Managed Service:** The cloud service provider manages the underlying setup, such as deploying and managing databases or developer platforms.
  - **Serverless:** Although servers are involved, the customer does not manage them directly.
  - **Examples:** Microsoft Azure SQL databases, function applications for software development.

- **Software as a Service (SaaS):**
  - **Definition:** Delivers end-user productivity applications over the internet.
  - **Provider Responsibility:** Manages the underlying physical infrastructure, virtual machines, and software availability.
  - **User Responsibility:** Configuring end-user software, managing user accounts, and enabling security features like multi-factor authentication (MFA).
  - **Example:** Outlook.com web-based email service.

## Securing the Cloud  

##### **Cloud Service Provider (CSP) Responsibilities**
- **Hardware and Infrastructure:**
  - Management of physical hardware, including servers, storage arrays, routers, and power in data centers.
  - Maintenance tasks such as HVAC (Heating, Ventilation, and Air Conditioning) and hardware firmware updates.
- **Software (Depending on Service Model):**
  - For **Platform as a Service (PaaS)**: Responsible for underlying virtual machines and database software.
  - For **Software as a Service (SaaS)**: Manages the entire software stack, including interfaces and system functionality (e.g., Gmail, Outlook.com).

##### **Cloud Customer (Tenant) Responsibilities**
- **Internet Connectivity:**
  - Ensuring reliable internet access, possibly through multiple ISPs or dedicated WAN circuits for mission-critical cloud services.
- **Cross-Region Replication:**
  - Configuring replication for storage accounts or virtual machines across regions to increase availability.
- **Service Configuration:**
  - Managing and configuring cloud resources like VMs, storage, and network settings.
  - Applying patches and updates to software or systems under customer control.

#### **Cloud Security Controls**

##### **Cloud-Specific Security Tools**
- **Cloud Access Security Broker (CASB):**
  - Acts as a proxy between on-premises clients and cloud services.
  - Enforces security policies, such as restricting VM deployment types, limiting storage sizes, and performing threat detection during file uploads.
- **Next-Generation Secure Web Gateway (SWG):**
  - Extends CASB functionalities with additional features like web content filtering, standard firewall operations, and Data Loss Prevention (DLP) policies.

##### **Cloud Firewall and Policies**
- **Network Security Groups (NSGs):**
  - Layer 4 packet filtering firewalls in the cloud, allowing or denying traffic to VMs or networks.
- **Cloud Policies (e.g., Azure Policy):**
  - Enforce deployment rules and compliance checks, such as ensuring VMs use a hardened image or verifying PCI DSS compliance.

##### **Data Loss Prevention (DLP)**
- **Example: Azure Information Protection (AIP):**
  - DLP policies in the cloud control access to sensitive data and restrict sharing, especially with external users.
  - Example: Blocking external access to content on SharePoint, OneDrive, and Teams.

##### **Cloud Monitoring and Logging**
- **Monitoring Cloud Services:**
  - Essential for detecting abnormalities or suspicious activities, such as unauthorized VM deployments or app usage.
- **Log Forwarding:**
  - Centralizes log data for easier monitoring and analysis, reducing the need to manually review logs.
  - **Azure Monitor:** The central log monitoring tool in the Microsoft Azure cloud environment.
