---
mindmap-plugin: basic
---
# Attacking Common Services
## Protocol Specific
## Service Misconfigurations
- Anonymous Authentication
- Misconfigured Access Rights
	- Permission to read every FTP stored document
- Unnecessary Defaults
	- Default Accounts
	- Unnecessary features
	- Error handling releals stack traces or informative error messages
	- For upgraded systems, security features are disabled/not configured
- Ways to prevent misconfigurations
	- Admin interfaces should be disabled.
	- Debugging is turned off.
	- Disable the use of default usernames and passwords.
	- Set up the server to prevent unauthorized access, directory listing, and other issues.
	- Run scans and audits regularly to help discover future misconfigurations or missing fixes.
- Ways to secure the installation processes by OWASP Top 10
	- Repeatable hardening process
	- Development, QA, and production should be configured identical with different credentials
	- Remove or do not install unused features and frameworks.
	- Review cloud storage permissions
	- Review and update the configurations appropriate to all security notes, updates, and patches 
	- Segmentation, containerization, or cloud security groups (ACLs).
	- An automated process to verify the effectiveness of the configurations and settings in all environments.
## FTP
- General
	- TCP/21
- Enumeration
	- $ sudo nmap -sC -sV -p 21 192.168.2.142 
- Misconfigurations
	- anonymous login
- Specific Attacks
	- Brute Forcing login
		- medusa -u fiona -P /usr/share/wordlists/rockyou.txt -h 10.129.203.7 -M ftp 
	- FTP Bounce Attack
		- nmap -Pn -v -n -p80 -b anonymous:password@10.10.110.213 172.17.0.2
	- Directory Traversal
	- Arbitrary File Write
## SMB
- General
	- uses as failover NetBIOS over TCP/IP (NBT) using TCP port 139 and UDP ports 137 and 138
	- TCP/445
- Enumeration
	- sudo nmap 10.129.14.128 -sV -sC -p139,445
- Misconfigurations
	- Null session, authentication is not required
	- Anonymous Authentication
		- smbclient -N -L //10.129.14.128
		- smbmap -H 10.129.14.128
		- rpcclient -U'%' 10.10.110.17
		- ./enum4linux-ng.py 10.10.11.45 -A -C
- Specific Attacks
	- Brute forcing
	- Password spraying
	- Remote Code Execution (RCE)
	- Dumping Credential Databases
	- Pass-the-Hash (PtH)
	- Forced Authentication Attacks, NTLM Relay
- Tools
	- smbclient
	- CrackMapExec
	- SMBMap
	- Impacket
	- psexec.py
	- smbexec.py
	- smbmap
	- rpcclient
	- enum4linux
- Connect or Disconnect computer to a shared resource
	- \> net use n: \\192.168.220.129\Finance
	- \> net use n: \\192.168.220.129\Finance /user:plaintext Password123
	- PS > New-PSDrive -Name "N" -Root "\\192.168.220.129\Finance" -PSProvider "FileSystem"
	- PS > New-PSDrive -Name "N" -Root "\\192.168.220.129\Finance" -PSProvider "FileSystem" -Credential $cred
	- $ sudo mount -t cifs -o username=plaintext,password=Password123,domain=. //192.168.220.129/Finance /mnt/Finance
	- $ mount -t cifs //192.168.220.129/Finance /mnt/Finance -o credentials=/path/credentialfile
- Search for context in share
	- \> dir n:\*cred* /s /b
	- \> findstr /s /i cred n:\*.*
	- PS > Get-ChildItem -Recurse -Path N:\ -Include *cred* -File
	- PS > Get-ChildItem -Recurse -Path N:\ | Select-String "cred" -List
	- $ find /mnt/Finance/ -name *cred*
	- $ grep -rn /mnt/Finance/ -ie cred
## SQL Databases
- General
	- MSSQL uses ports TCP/1433 and UDP/1434
	- when MSSQL operates in a "hidden" mode, it uses the TCP/2433 port
	- MySQL uses TCP/3306
- Enumerations
- Misconfigurations
- Specific Attacks
	- SQL Injection
	- Command execution with xp_cmdshell
	- Write to local files
	- XP_DIRTREE Hash Stealing
	- XP_SUBDIRS Hash Stealing
	- Impersonating existing users
- Tools 
	- mssql-cli
	- mycli
	- mssqlclient.py
	- dbeaver
	- MySQL Workbench
	- SQL Server Management Studio or SSMS
- Relational SQL
	- MySQL 
		- mysql.exe -u username -pPassword123 -h 10.129.20.13
		- $ mysql -u username -pPassword123 -h 10.129.20.13
	- MSSQL
		- sqlcmd -S 10.129.20.13 -U username -P Password123
		- $ sqsh -S 10.129.20.13 -U username -P Password123
- Non-relational SQL
	- NoSQL
## RDP
- General
	-  TCP/3389
- Enumeration
	- nmap -Pn -p3389 192.168.2.143 
- Misconfigurations
	- Password guessing
	- Password spraying
		- crowbar -b rdp -s 192.168.220.142/32 -U users.txt -c 'password123'
		- hydra -L usernames.txt -p 'password123' 192.168.2.143 rdp
- Specific Attacks
	- RDP Session Hijacking
	- RDP Pass-the-Hash (PtH)
- Tools
- Connect to RDP
- Search for RDP
## DNS
- General
	-  UDP/53, but DNS will rely on TCP/53 more heavily as time progresses
- Enumeration
	- $ nmap -p53 -Pn -sV -sC 10.10.110.213
	- $ dig AXFR @ns1.inlanefreight.htb inlanefreight.htb
	- $ fierce --domain zonetransfer.me
	- $ ./subfinder -d inlanefreight.com -v
	- $ ./subbrute inlanefreight.com -s ./names.txt -r ./resolvers.txt
	- $ host support.inlanefreight.com
- Misconfigurations
- Specific Attacks
	- DNS Zone Transfer
	- Domain Takeovers 
	- Subdomain Takeover
	- DNS brute-forcing
	- DNS Spoofing (MITM)
	- Local DNS Cache Poisoning
- Tools
	- dig
	- fierce
	- subfinder
	- host
	- ettercap
	- bettercap

## SMTP
## File Share Services
- Internal Services
	- SMB
	- NFS
	- FTP
	- TFTP
	- SFTP
- Cloud
	- Dropbox
	- Google Drive
	- OneDrive
	- SharePoint
	- AWS S3
	- Azure Blob Storage
	- Google Cloud Storage

## Email Services
- Tools
	- Thunderbird
	- Claws
	- Geary
	- MailSpring
	- mutt
	- mailutils
	- sendEmail
	- swaks
	- sendmail
	- smtp-user-enum
	- o365spray.py
- Enumeration
	- host -t MX hackthebox.eu
	- dig mx plaintext.do | grep "MX" | grep -v ";"
	- sudo nmap -Pn -sV -sC -p25,143,110,465,587,993,995 10.129.14.128
	- Telnet VRFY Command
	- Telnet EXPN Command
	- Telnet RCPT TO Command
	- Telnet USER Command
	- smtp-user-enum -M RCPT -U userlist.txt -D inlanefreight.htb -t 10.129.203.7
- Misconfigurations
	- Anonymous Authenticaton
	- Support protocols that can be used to enumerate valid usernames
- Specific Attacks
	- Password Attacks
	- Password Spraying
	- Open Relay
- Used to Send messages
	- SMTP
- Used to Receive messages
	- POP3
	- IMAP


## The Concept of Attacks
- Source
	- Code
	- Libraries
	- Config
	- APIs
	- User Input
	- others
- Processes
	- PID
	- Input
	- Data processing
	- Variables
	- Logging
	- others
- Privileges
	- System
	- User
	- Groups
	- Policies
	- Rules
	- others
- Destination
	- Local
		- Files
		- Process
	- Network
		- Network Address
		- Route
