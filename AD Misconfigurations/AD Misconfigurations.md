# Active Directory Misconfigurations
## Microsoft Exchange Related Group Membership
- Origin
	- The default installation within AD environment opens up many attack vectors
	- The group Exchange Windows Permissions is not listed as protected group
	- Group members are granted ability to write a DACL to the domain object
	- With DACL write ability user can be leveraged to DCSync privileges
- Attacks
	- PrivExchange

## Printer Bug
- MS-RPRN (Print System Remote Protocol)  flaw
- This attack can be leveraged to relay to LDAP and grant your attacker account DCSync privileges to retrieve all password hashes from AD.
- https://www.sygnia.co/threat-reports-and-advisories/demystifying-the-print-nightmare-vulnerability/

## Sniffing LDAP Credentials
- Many applications and printers store LDAP credentials in their web admin console to connect to the domain. 
- hese consoles are often left with weak or default passwords. Sometimes, these credentials can be viewed in cleartext
- Test connection function that we can use to gather credentials by changing the LDAP IP address to that of our attack host, cleatext creds send
- https://grimhacker.com/2018/03/09/just-a-printer/


## Dumping AD DNS using adidnsdump
- https://dirkjanm.io/getting-in-the-zone-dumping-active-directory-dns-with-adidnsdump/

## Password in Description Field
- passwords in the user account Description or Notes fields and can be quickly enumerated using PowerView. 

## PASSWD_NOTREQD Field
- https://ldapwiki.com/wiki/Wiki.jsp?page=PASSWD_NOTREQD
- If this is set, the user is not subject to the current password policy length, meaning they could have a shorter password or no password at all
- Get-DomainUser -UACFilter PASSWD_NOTREQD | Select-Object samaccountname,useraccountcontrol

## Credentials in SMB Shares and SYSVOL Scripts
- check with crackmapexec --local-auth flag against computer or dc

## Group Policy Preferences (GPP) Passwords
- when a new GPP is created, an .xml file is created in the SYSVOL share
- any domain user can read these files as they are stored on the SYSVOL share, 
- all authenticated users in a domain, by default, have read access to this domain controller share.
- this was pathed by the patch does not remove existing Groups.xml files with passwords from SYSVOL. 
- if you delete the GPP policy instead of unlinking it from the OU, the cached copy on the local computer remains.
- decrypt them with gpp-decrypt tool for kali
- use cme to locate 'crackmapexec smb -L | grep gpp'
- It is also possible to find passwords in files such as Registry.xml when autologon is configured via Group Policy
- We can hunt for this using CrackMapExec with the gpp_autologin module, or using the Get-GPPAutologon.ps1 script included in PowerSploit.
- crackmapexec smb 172.16.5.5 -u forend -p Klmcargo2 -M gpp_autologin

## ASREPRoasting
- obtain TGT for any account that has the 'Do not require Kerberos pre-authentication' setting enabled. 
- many vendor installation guides specify that their service account be configured in this way.
- an attacker can request authentication data for the affected account and retrieve an encrypted TGT from the Domain Controller. 
- this can be subjected to an offline password attack using a tool such as Hashcat or John the Ripper.
- similar to Kerberoasting, but it involves attacking the AS-REP instead of the TGS-REP. An SPN is not required.
- can be performed with the Rubeus toolkit and other tools to obtain the ticket for the target account.
- If an attacker has GenericWrite or GenericAll permissions over an account, they can enable this attribute and obtain the AS-REP ticket 
- like Kerberoasting, the success of this attack depends on the account having a relatively weak password.
- attack does not require any domain user context and can be done by just knowing the SAM name for the user without Kerberos pre-auth.
- Kerbrute, the tool will automatically retrieve the AS-REP for any users found that do not require Kerberos pre-authentication.
- Get-NPUsers.py from the Impacket toolkit to hunt for all users with Kerberos pre-authentication not required. 
- https://www.tenable.com/blog/how-to-stop-the-kerberos-pre-authentication-attack-in-active-directory

## Group Policy Object (GPO) Abuse
- Adding additional rights to a user (such as SeDebugPrivilege, SeTakeOwnershipPrivilege, or SeImpersonatePrivilege)
- Adding a local admin user to one or more hosts
- Creating an immediate scheduled task to perform any number of actions

## Active Directory Certificate Services (AD CS) attacks
## Kerberos Constrained Delegation

## Kerberos Unconstrained Delegation

## Kerberos Resource-Based Constrained Delegation (RBCD)